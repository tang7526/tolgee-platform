import e,{useState as n,useEffect as t,Suspense as r,useContext as o,useCallback as s,useRef as i}from"react";import{getFallback as c,getFallbackArray as l,getTranslateProps as a}from"@tolgee/web";export*from"@tolgee/web";const u={useSuspense:!0},d=e.createContext(void 0),p=({tolgee:o,options:s,children:i,fallback:c})=>{const[l,a]=n(!o.isLoaded());t((()=>(o.run().finally((()=>{a(!1)})),()=>{o.stop()})),[o]);const p=Object.assign(Object.assign({},u),s);return p.useSuspense?e.createElement(d.Provider,{value:{tolgee:o,options:p}},l?c:e.createElement(r,{fallback:c||null},i)):e.createElement(d.Provider,{value:{tolgee:o,options:p}},l?c:i)};let b;const g=e=>n=>(b={tolgee:n,options:Object.assign(Object.assign({},u),e)},n);const f=()=>{const e=o(d)||b;if(!e)throw new Error("Couldn't find tolgee instance, did you forgot to use `TolgeeProvider`?");return e},m=()=>{const[e,t]=n(0);return{instance:e,rerender:s((()=>{t((e=>e+1))}),[t])}},v=(e,n)=>{const{tolgee:r,options:o}=f(),a=c(e),u=l(a).join(":"),d=Object.assign(Object.assign({},o),n),{rerender:p,instance:b}=m(),g=i(),v=i([]);v.current=[];const h=r.isLoaded(a);t((()=>{const e=r.onNsUpdate(p);return g.current=e,h||e.subscribeNs(a),v.current.forEach((n=>{e.subscribeNs(n)})),()=>{e.unsubscribe()}}),[h,u,r]),t((()=>(r.addActiveNs(a),()=>r.removeActiveNs(a))),[u,r]);const j=s((e=>{var n;const t=null!==(n=e.ns)&&void 0!==n?n:null==a?void 0:a[0];return(e=>{var n;v.current.push(e),null===(n=g.current)||void 0===n||n.subscribeNs(e)})(t),r.t(Object.assign(Object.assign({},e),{ns:t}))}),[r,b]);if(d.useSuspense&&!h)throw r.addActiveNs(a,!0);return{t:j,isLoading:!h}},h=(e,n)=>{const{t:t,isLoading:r}=v(e,n);return{t:s(((...e)=>{const n=a(...e);return t(n)}),[t]),isLoading:r}},j=n=>{if(!n)return;const t={};return Object.entries(n||{}).forEach((([n,r])=>{if("function"==typeof r)t[n]=e=>r(E(e));else if(e.isValidElement(r)){const o=r;t[n]=n=>void 0!==o.props.children?e.cloneElement(o):e.cloneElement(o,{},E(n))}else t[n]=r})),t},E=n=>Array.isArray(n)?e.Children.toArray(n):n,y=n=>{const t=n.keyName||n.children;void 0===t&&console.error("T component: keyName not defined");const r=n.defaultValue||(n.keyName?n.children:void 0),{t:o}=v(),s=E(o({key:t,params:j(n.params),defaultValue:r,noWrap:n.noWrap,ns:n.ns}));return e.createElement(e.Fragment,null,s)},N=e=>{const{tolgee:n}=f(),{rerender:r}=m();return t((()=>{const t=null==e?void 0:e.map((e=>n.on(e,r)));return()=>{null==t||t.forEach((e=>e.unsubscribe()))}}),[null==e?void 0:e.join(":")]),n};export{g as GlobalContextPlugin,y as T,p as TolgeeProvider,d as TolgeeProviderContext,N as useTolgee,h as useTranslate};
//# sourceMappingURL=tolgee-react.esm.min.mjs.map
